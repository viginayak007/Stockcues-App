/*! app 2018-06-23 */

angular.module("Main",[]),angular.module("login",[]),angular.module("Home",[]),angular.module("Discover",[]),angular.module("Investments",[]);var app=angular.module("Stock-Cues",["ngRoute","ngCookies","ngSanitize","googlechart","ui.bootstrap","Main","login","Home","Discover","Investments"]);function confirmExit(){return"You have attempted to leave this page. Are you sure?"}app.config(["$routeProvider","$locationProvider",function($routeProvider,$locationProvider){$routeProvider.when("/login",{controller:"loginController",templateUrl:"views/Login/login.html"}).when("/",{controller:"mainController",templateUrl:"views/Main/main.html"}).otherwise({redirectTo:"/login"}),$locationProvider.html5Mode(!0)}]),app.run(["$rootScope","$location","$cookieStore","$http",function($rootScope,$location,$cookieStore,$http,$locationProvider){$rootScope.globals=$cookieStore.get("globals")||{},$rootScope.$on("$locationChangeStart",function(event,next,current){$rootScope.globals.code=$location.search().code,$rootScope.globals.code||$location.path("/login")})}]),window.onbeforeunload=confirmExit,app.controller("loginController",function($scope,$rootScope,$http,$window){$scope.redirect=function(){$http.get("http://localhost:16557/GetLoginURL").then(function(response){$window.location.href=response.data},function(response){alert("Can't get URL. Kindly contact Support")})}}),app.controller("mainController",function($scope,$location,$window,$http,$cookieStore){$scope.Data,$scope.discoverDetails,$scope.link="views/Pages/discover.html",$scope.strategyId=0,$scope.strategyStockData=[],$scope.strategytotalAmount=0,$scope.copyStrategyStockData=[];var childWindow={},user={},orderlistobj=[];$scope.confirmAmount=function(){(orderlistobj=[]).push({symbol:"UNITECH",exchange:"NSE",series:"EQ",quantity:1,price:1,side:"buy",orderType:"m",position:"d",tif:"day"}),orderlistobj.push({symbol:"ANTGRAPHIC",exchange:"NSE",series:"EQ",quantity:1,price:1,side:"buy",orderType:"m",position:"d",tif:"day"});var _randPopoutUrl="https://pro.upstox.com/trade/?s="+Math.random().toString().slice(2);childWindow=window.open(_randPopoutUrl,"_blank","width=850,height=560,left=200,top=100")},window.addEventListener("message",function(e){if(function(message){var _msg={};switch(console.log(orderlistobj),message){case"getOrderList":_msg={type:"getOrderList",data:orderlistobj},childWindow.postMessage(JSON.stringify(_msg),"*");break;case"getApiKey":_msg={type:"getApiKey",data:"2nZLD6PYFZ6iC4byDCR302H0xpadNzpU95Ai1RwU"},childWindow.postMessage(JSON.stringify(_msg),"*");break;case"getLoginKey":(_msg={type:"getLoginKey",lka:!1}).data=user,_msg.lka=!0,childWindow.postMessage(JSON.stringify(_msg),"*")}}(e.data),""!=e.data){var res=e.data.split("|");$http({method:"GET",url:"http://localhost:16557/SaveOrderDetails",params:{orderIds:res[1]}}).then(function(response){console.log(e.data)},function(response){console.log(e.data),alert("error"),$window.location.assign("/login")})}},!1),$scope.Data||$http({method:"GET",url:"http://localhost:16557/getUserAllDetails",params:{code:$location.search().code}}).then(function(response){$scope.Data=angular.fromJson(response.data)},function(response){alert("error"),$window.location.assign("/login")}),$scope.pageChanged=function(pageName){$scope.link="views/Pages/"+pageName+".html"},$scope.changeStrategyID=function(id){$scope.strategyId=id,$scope.strategyStockData=[],$scope.strategytotalAmount=0,$scope.minStockPrice=0,orderlistobj=[],angular.forEach($scope.Data[2],function(value,key){value.strategyId==id&&($scope.strategytotalAmount+=value.currentPrice,$scope.strategyStockData.push(value),orderlistobj.push({symbol:value.symbol,exchange:"NSE",series:"EQ",quantity:parseInt(value.qty),side:"buy",orderType:"m",position:"d",tif:"day"}))}),$scope.minStockPrice=Math.min.apply(Math,$scope.strategyStockData.map(function(stock){return stock.currentPrice})),$scope.copyStrategyStockData=angular.copy($scope.strategyStockData)},$scope.changeAmt=function(budgetAmt){console.log(budgetAmt),$scope.strategyStockData=[],$scope.strategyStockData=angular.copy($scope.copyStrategyStockData),isNaN(budgetAmt)||$scope.changeQty(budgetAmt)},$scope.changeQty=function(budgetAmt){console.log("call"),orderlistobj=[],budgetAmt>=$scope.minStockPrice?(angular.forEach($scope.strategyStockData,function(value,key){if(parseFloat(value.currentPrice)<=budgetAmt)value.qty++,budgetAmt-=value.currentPrice;else if(0==budgetAmt||$scope.minStockPrice>=budgetAmt)return;orderlistobj.push({symbol:value.symbol,exchange:"NSE",series:"EQ",quantity:value.qty,side:"buy",orderType:"m",position:"d",tif:"day"})}),$scope.minStockPrice<=budgetAmt&&$scope.changeQty(budgetAmt)):angular.forEach($scope.strategyStockData,function(value,key){orderlistobj.push({symbol:value.symbol,exchange:"NSE",series:"EQ",quantity:value.qty,side:"buy",orderType:"m",position:"d",tif:"day"})})},$scope.myChartObject={type:"AreaChart",displayed:!1,data:{cols:[{id:"month",label:"Month",type:"string",p:{}},{id:"sales",label:"Sales",type:"number",p:{}},{id:"expenses",label:"Expenses",type:"number",p:{}}],rows:[{c:[{v:"3 JAN 2018"},{v:250,f:"42 items"},{v:480,f:"Ony 12 items"}]},{c:[{v:"9 JAN 2018"},{v:280},{v:140,f:"1 unit (Out of stock this month)"}]},{c:[{v:"15 JAN 2018"},{v:102},{v:200}]},{c:[{v:"21 JAN 2018"},{v:96},{v:450}]}]},options:{isStacked:"true",fill:150,displayExactValues:!0,vAxis:{gridlines:{count:5}}},formatters:{}},$scope.myChart={type:"PieChart",displayed:!1,data:{cols:[{id:"t",label:"MF",type:"string"},{id:"s",label:"INSURANCE",type:"number"}],rows:[{c:[{v:"MF"},{v:20}]},{c:[{v:"INSURANCE"},{v:80}]}]},options:{colors:["#cccccc","#3d6a94"],pieStartAngle:200,chartArea:{width:"100%",height:250},legend:{position:"none"}}},$scope.segmentHeader=function(){if($scope.Data[3]){for(var uniqueNames=[],i=0;i<$scope.Data[3].length;i++)-1===uniqueNames.indexOf($scope.Data[3][i].Segment)&&uniqueNames.push($scope.Data[3][i].Segment);return uniqueNames}}}),app.filter("unique",function(){return function(arr,targetField){var i,unique,obj,values=[],results=(arr.length,[]);for(i=0;i<arr.length;i++){for(obj=arr[i],unique=!0,v=0;v<values.length;v++)obj[targetField]==values[v]&&(unique=!1);unique&&(values.push(obj[targetField]),results.push(obj))}return results}});